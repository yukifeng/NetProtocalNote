# 网络协议笔记2
本次将网络分层分为5层，从上到下依次为：

| 层级 | 协议 | 发送的内容  |
| --- | --- | ---- |
| 应用层 |FTP HTTP | 报文，用户数据 |
| 运输层 | TCP UDP | 段（Segments） |
| 网络层 | IP ICMP | 包（Packets） |
| 链路层 | CSMA/CD PPP | 帧（Frames） |
| 物理层 |  | 比特流（Bits） |

## 物理层

- 定义了接口标准，线缆标准，传输速率、方式等
- 发送数字信号和模拟信号
 - 数字信号：
	 	1. 连续信号，适合长距离传输
	 	2. 抗干扰能力差，受干扰后波形变形难以纠正
 - 模拟信号：
 		1. 离散的信号，不适合长距离
 		2. 抗干扰能力差，受干扰后波形失真可以修正

### 数据通信模型

![yxQ4bR.png](https://s3.ax1x.com/2021/02/26/yxQ4bR.png)

### 信道

- 信息传输的通道，一条介质上可以有多条信道
- 单工通信
	- 信号只能往一个方向传播
- 半双工
	- 可以双向传播，但必须交替进行，同一时间只能一个方向
- 全双工
	- 可以双膝那个传输

## 链路层
- 从1个节点到良心节点的物理线路，中间没有其他交换节点
	- 不同类型的数据链路协议可能不同
	  1. 广播信道： CSMA/CD协议
	  2. 点对点信道： PPP协议

- 数据链路的三个基本问题
	- 封装成帧
	- 透明传输
	- 差错检验

#### 封装成帧

![yzYhgx.png](https://s3.ax1x.com/2021/02/26/yzYhgx.png)

#### 透明传输

![yzYf81.png](https://s3.ax1x.com/2021/02/26/yzYf81.png)
![yzYIKK.png](https://s3.ax1x.com/2021/02/26/yzYIKK.png)

#### 差错检验

![yzYWCR.png](https://s3.ax1x.com/2021/02/26/yzYWCR.png)

#### CSMA/CD协议
- 使用CSMA/CD协议的网络可以称为以太网，他传输的是以太网帧
	- 以太网帧格式：以太V2， IEEE802.3
- 为了能检测正在发送的帧是否冲突，至少需要64字节
- 使用交换机组件的网络，支持全双工通信，不需要该协议，但传输的帧依旧是以太网帧，所以依旧叫以太网

![yzr4Ff.png](https://s3.ax1x.com/2021/02/26/yzr4Ff.png)
![yzrfTP.png](https://s3.ax1x.com/2021/02/26/yzrfTP.png)

## 网络层

- 网络层由 首部 和 数据 构成
	- 数据： 很多时候是由传输层传递下来的数据段

###网络层数据模型详情

![6pdshD.png](https://s3.ax1x.com/2021/02/27/6pdshD.png)

- 版本：占4位，分为ipv4（0b0100）和ipv6（0b0110）
- 首部长度：占4位，二进制数值*4后是最终长度，
	- 最大值是60（0b1111）
	- 最小值是20（0b0101）
- 区分服务：占8位，可以用于提高网络的服务质量
- 总长度：占16位，首部+数据的长度和，最大值为65536（2^16）
![6pwDrn.png](https://s3.ax1x.com/2021/02/27/6pwDrn.png)
	- 由于帧（链路层）的数据不能超过1500字节，所以过大的数据包，需要分片（fragments）传给链路层
	- 每片都有自己的网络层首部
- 标识（Identification）：占16位，数据包的ID，
	- 数据包分片时，所有的数据包的标识也是同一个
	- 有个计数器专门管理数据包id，每次自增1
- 标志（Flags）：占3位，
	- 第1位（Reserved Bit）：保留
	- 第2位（Dont Fragment）：1表示不允许分片，0表示允许分片
	- 第3位（More Fragments）：1表示不是最后一片，0表示是最后一片
- 片偏移（Fragment Offset）：占13位
	- 片偏移*8:字节偏移
	- 每一片的长度一定是8的倍数
	- 图解：
	![6p0ii8.png](https://s3.ax1x.com/2021/02/27/6p0ii8.png)
	- 实例：
	![6p0CIf.png](https://s3.ax1x.com/2021/02/27/6p0CIf.png)
- 生存时间（Time To Live TTL）：占8位
	- 每个路由器转发之前会-1，当为0时会返回错误
- 协议（Protocol）：占8位
	- 表示封装的数据所使用的协议类型
	
	| 协议 | 值 |
	| --- | ---- |
	|ICMP | 1 |
	|IGMP | 2 |
	|IP | 4 |
	|TCP | 6 |
	|EGP | 8 |
	| IGP | 9 |
	|UDP | 17 |
	|IPv6 | 41 |
	|ESP | 50 |
	|OSPF | 89 |
	
- 首部检验和（Header Checksum）：16位
	- 用于检查首部是否有错误
- 源IP地址，目标IP地址：字面意思