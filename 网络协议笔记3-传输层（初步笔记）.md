# 网络协议笔记3-传输层（初步笔记）
- 传输层的协议有两个，TCP和UDP
	- TCP和UDP的特点和区别：
![TCP和UDP的特点和区别.png](https://s3.ax1x.com/2021/02/28/6Cbn7n.png)

###UDP
####数据格式
- UDP是无连接的，减少了建立和释放链接的开销
- UDP尽最大能力交付，不保证可靠交付
	- 所以不需要维护复杂的参数，首部只有8个字节
-UDP长度： 占16位，首部长度 + 数据长度
![首部示意图.png](https://s3.ax1x.com/2021/02/28/6Cbf4P.png)

#### 检验和
- 检验和的计算内容： 伪首部 + 首部 + 数据
	- 伪首部：仅在计算检验和时起作用，不传递到网络层
![6CbvCV.png](https://s3.ax1x.com/2021/02/28/6CbvCV.png)
#### 端口
- UDP首部中端口占用2字节，取值范围0-65535
- 客户端的端口时随即开启的
- 防火墙可以设置开启/关闭某些端口提高安全性

###TCP
- TCP首部示意图：

![6CqhZ9.png](https://s3.ax1x.com/2021/02/28/6CqhZ9.png)

- 数据偏移：占4位，取值范围0x0101-0x1111
	- 首部长度需要 * 4 即 20-60字节	
- 保留：占6位，目前全为0
- 检验和：伪首部 + 首部 + 数据
	- 伪首部：占12字节，仅在计算检验和时起作用，不传递到网络层（与UDP一样）
- 标志位：
	- URG（Urgent）：当URG = 1时生效，表明需要优先传输
	- ACK（Acknowledgment）：当ACK = 1时生效
	- PSH（Push）
	- RST（Reset）：当RST = 1时，表明链接出错，需要释放链接重新建立
	- SYN（Synchronization）：
		- 当SYN = 1，ACK = 0时，表明这是一个建立连接的请求
		- 若对方同意，则恢复SYN = 1，ACK = 1
	- FIN（Finish）：当FIN = 1时，表明数据发送完毕，需要释放
- 序号（Sequence Number）：
	- 占4字节
	- 首先，在传输过程的每一个字节都会有一个编号
	- 在建立连接后，序号代表这次传给对方的TCP数据第一个字节的编号
- 确认号（Acknowledgment Number）：
	- 占4字节
	- 建立连接后，确认号代表期望对方下次传过来的TCP数据部分的第一个字节编号
- 窗口（Window）
	- 两字节
	- 有流量控制功能，高速对方下一次允许发送的数据大小

###TCP的特点
- 可靠传输
####停止等待ARQ协议
	- 在服务端发送数据后，没有接收到客户端回复收到信息的报告的话，会重新发送该数据段，若后面再次收到之前发送过的数据段的回复，会丢弃掉该数据
	![6COp79.png](https://s3.ax1x.com/2021/02/28/6COp79.png)
	![6CXSv8.png](https://s3.ax1x.com/2021/02/28/6CXSv8.png)
	- 多次发送失败的话会发送Reset，断开连接
####连续ARQ协议 + 滑动窗口协议
- 接收方通知发送方当前缓存区可以接受的大小，发送方将数据段分成n组同时发送，接收方收到后通知发送方下次发送开始的字节编号，再次分段发送。
	- 通信过程中，若中间某个数据包丢失（如1-5丢失了3）
	- 会通过重传最后确认的分组后续的分组（回复最后数据是2，重传345）
	- 为解决上述问题，有协议可以将45收到的消息返回，使发送方只发送3
	SACK示意图：
	![6CjkLD.png](https://s3.ax1x.com/2021/02/28/6CjkLD.png)
	- kind：1字节，固定为5，表示是SACK
	- Length：1字节，比报名Sack一共占用多少字节
	- Left Edge：4字节，左边界
	- Right Edge：4字节，右边界
	- 其中左右边界存储接收方收到的数据段的左边的字节号和右边的字节号，表示中间位置已经收到
	- 该数据占用8个字节，由于TCP首部的选项最多40字节，所以最多携带4组信息，意味着有可能不能完全满足所有收到的数据段全部回复
	- SACK选项的最大占用字节数 = 4 * 8 + 2 = 34
- 流量控制
- 拥塞控制
- 连接管理	